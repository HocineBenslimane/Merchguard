!function(){"use strict";function t(){return"https://merch.amazon.com"===window.location.origin&&"/designs/new"===window.location.pathname}function n(){var e,t;!document.querySelector(".snap-upload-container")&&((e=new MutationObserver((e,t)=>{var n=document.querySelector(".row.mb-4");n&&(l(n),t.disconnect())})).observe(document.body,{childList:!0,subtree:!0}),t=document.querySelector(".row.mb-4"))&&(l(t),e.disconnect())}t()&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{t()&&n()}):t()&&n());{let e=window.location.href;setInterval(()=>{window.location.href!==e&&(e=window.location.href,t())&&n()},1e3);const o=history.pushState,a=(history.pushState=function(...e){o.apply(this,e),window.dispatchEvent(new Event("locationchange"))},history.replaceState);history.replaceState=function(...e){a.apply(this,e),window.dispatchEvent(new Event("locationchange"))},window.addEventListener("locationchange",()=>{t()&&n()})}const E=(()=>{let t;var n=[];for(let e=0;e<256;e++){t=e;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;n[e]=t}return n})();function l(t){if(!t.querySelector(".snap-upload-container")){const r=document.createElement("div");r.classList.add("snap-upload-container"),r.style.border="2px dashed #470CED",r.style.borderRadius="8px",r.style.width="100%",r.style.height="75%",r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="center",r.style.justifyContent="center",r.style.boxSizing="border-box",r.style.cursor="pointer",r.style.marginLeft="16px",r.style.backgroundColor="white",r.style.position="relative";var n=d();if(r.appendChild(n),r.addEventListener("dragover",e=>{e.preventDefault(),r.style.borderColor="#01BB87"}),r.addEventListener("dragleave",()=>{r.style.borderColor="#470CED"}),r.addEventListener("drop",e=>{e.preventDefault(),r.style.borderColor="#470CED",m(e.dataTransfer.files[0],r)}),r.addEventListener("click",()=>{const e=document.createElement("input");e.type="file",e.accept="image/png",e.style.display="none",e.onchange=()=>{m(e.files[0],r)},document.body.appendChild(e),e.click(),document.body.removeChild(e)}),t.appendChild(r),!(n=r).nextElementSibling||"download-toggle-container"!==n.nextElementSibling.id){(a=document.createElement("div")).id="download-toggle-container",a.style.cssText=`
      display: flex;
      align-items: center;
      justify-content: flex-start;
      cursor: pointer;
      margin-top: 10px;
      width: 100%;
    `;const i=document.createElement("div"),s=(i.style.cssText=`
      width: 36px;
      height: 18px;
      border-radius: 18px;
      background-color: rgb(207, 212, 212);
      position: relative;
      transition: background-color 0.3s;
      margin-right: 10px;
    `,document.createElement("span"));s.style.cssText=`
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: white;
      position: absolute;
      top: 3px;
      left: 3px;
      transition: transform 0.3s;
    `,i.appendChild(s);var e=document.createElement("span");e.textContent="Download after processing",e.style.cssText=`
      font-size: 14px;
      color: rgb(100, 100, 100);
      user-select: none;
    `;{var l=i;var o=s;let e=localStorage.getItem("downloadAfterProcessing");null===e&&(e="false",localStorage.setItem("downloadAfterProcessing",e)),"true"===e?(l.style.backgroundColor="#470CED",o.style.transform="translateX(18px)"):(l.style.backgroundColor="rgb(207, 212, 212)",o.style.transform="translateX(0)")}a.addEventListener("click",()=>{var e=i,t=s,n=!("true"===localStorage.getItem("downloadAfterProcessing"));localStorage.setItem("downloadAfterProcessing",n.toString()),n?(e.style.backgroundColor="#470CED",t.style.transform="translateX(18px)"):(e.style.backgroundColor="rgb(207, 212, 212)",t.style.transform="translateX(0)")}),a.appendChild(i),a.appendChild(e),n.parentNode.insertBefore(a,n.nextSibling)}if(!(e=r).nextElementSibling||"scaling-options-container"!==e.nextElementSibling.id){const c=document.createElement("div");c.id="scaling-options-container",c.style.cssText=`
      display: flex;
      align-items: center;
      justify-content: flex-start;
      margin-top: 20px;
      width: 100%;
      padding-left: 0;
    `,[{id:"scaleCustom",label:"",value:"custom"},{id:"scale100",label:"100%",value:"100"},{id:"scale85",label:"85%",value:"85"},{id:"scale75",label:"75%",value:"75"}].forEach(t=>{const n=document.createElement("label"),l=(n.style.cssText=`
        display: flex;
        align-items: center;
        margin-right: 15px;
        font-size: 14px;
        cursor: pointer;
        position: relative;
      `,document.createElement("input")),o=(l.type="radio",l.name="scaleOption",l.id=t.id,l.value=t.value,l.style.display="none",document.createElement("span"));function a(){var e;o.innerHTML="",l.checked?(o.style.display="inline-block",o.style.width="1rem",o.style.height="1rem",o.style.border="0.0625rem solid #470CED",o.style.borderRadius="50%",o.style.backgroundColor="#470CED",o.style.marginRight="5px",o.style.position="relative",(e=document.createElement("span")).style.height="0.5rem",e.style.width="0.5rem",e.style.backgroundColor="rgb(255, 255, 255)",e.style.borderRadius="50%",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",o.appendChild(e)):(o.style.display="inline-block",o.style.width="1rem",o.style.height="1rem",o.style.border="0.0625rem solid #470CED",o.style.borderRadius="50%",o.style.backgroundColor="#fff",o.style.marginRight="5px",o.style.position="relative")}if(o.style.cursor="pointer",o.addEventListener("click",()=>{var e;l.checked=!0,y(t.id,c),p(c),"scaleCustom"===t.id&&(e=n.querySelector('input[type="number"]'))&&e.focus()}),n.addEventListener("click",()=>{"scaleCustom"!==t.id&&(l.checked=!0,y(t.id,c),p(c))}),n.appendChild(l),n.appendChild(o),t.label&&n.appendChild(document.createTextNode(t.label)),"scaleCustom"===t.id){const i=document.createElement("input");i.type="number",i.min="50",i.max="100",i.step="0.1",i.style.width="64px",i.style.height="calc(1.5rem * 1.1)",i.style.marginLeft="5px",i.style.fontSize="13px",i.style.padding="2px",i.style.border="none",i.style.borderBottom="2px solid #ccc",i.style.borderRadius="0",i.style.transition="border-bottom 0.3s ease",i.disabled="scaleCustom"!==window.selectedScaleOption;var e=document.createElement("div"),r=(e.style.display="flex",e.style.alignItems="center",e.appendChild(i),document.createElement("span"));r.textContent="%",r.style.marginLeft="4px",r.style.fontSize="13px",e.appendChild(r),i.addEventListener("click",e=>{e.stopPropagation(),l.checked=!0,y("scaleCustom",c),p(c),i.focus()}),i.addEventListener("input",()=>{var e=parseFloat(i.value);!isNaN(e)&&50<=e&&e<=100?(localStorage.setItem("customScaleValue",i.value),i.style.borderColor="#ccc"):i.style.borderColor="red",g()}),l.customScaleInput=i,n.appendChild(e)}l.addEventListener("change",()=>{var e;a(),l.checked&&"scaleCustom"===l.id&&(e=n.querySelector('input[type="number"]'))&&e.focus()}),a(),c.appendChild(n)}),e.parentNode.insertBefore(c,e.nextSibling)}{let e=(a=t).querySelector(".snap-right-container");e||((e=document.createElement("div")).classList.add("snap-right-container","col"),a.appendChild(e));var n=a.querySelector(".snap-upload-container"),t=a.querySelector("#download-toggle-container"),a=a.querySelector("#scaling-options-container");n&&t&&a&&(e.appendChild(n),e.appendChild(a),e.appendChild(t),u(e,{display:"flex",flexDirection:"column",alignItems:"stretch"}),u(n,{alignSelf:"flex-end"}),u(a,{alignSelf:"flex-start",marginTop:"20px"}),u(t,{alignSelf:"flex-start",marginTop:"10px"}))}n=localStorage.getItem("selectedScaleOption"),window.selectedScaleOption=n||"scale100",(n=document.getElementById(window.selectedScaleOption))&&(n.checked=!0,n.dispatchEvent(new Event("change"))),"scaleCustom"===window.selectedScaleOption&&(n=document.querySelector('#scaling-options-container input[type="number"]'))&&(n.style.cursor="text",n.disabled=!1,(t=localStorage.getItem("customScaleValue"))&&(n.value=t),n.focus()),g()}}function d(){var e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center";const t=document.createElement("img");var n=chrome.runtime.getURL("assets/draganddrop.svg");t.src=n,t.alt="Drag and Drop",t.style.width="40px",t.style.height="40px",t.style.marginBottom="8px",t.onerror=()=>{t.style.display="none"};(n=document.createElement("p")).textContent="Upload and convert to 4500x5400px",n.style.fontSize="14px",n.style.fontWeight="700",n.style.color="#470CED",n.style.margin="0";var l=document.createElement("p");return l.textContent="Drag and drop PNG format",l.style.fontSize="14px",l.style.color="#9AA5B1",l.style.margin="0",e.appendChild(t),e.appendChild(n),e.appendChild(l),e}function p(e){e.querySelectorAll('input[type="radio"]').forEach(e=>{e.dispatchEvent(new Event("change"))})}function u(t,n){Object.keys(n).forEach(e=>{t.style[e]=n[e]})}async function m(t,n){var l,o,a,r,i,s;if(t&&"image/png"===t.type)try{(r=n).innerHTML="",r.style.borderColor="#FFA500",(i=document.createElement("div")).style.display="flex",i.style.flexDirection="column",i.style.alignItems="center",(s=document.createElement("p")).textContent="Processing image...",s.style.fontSize="14px",s.style.fontWeight="700",s.style.color="#FFA500",s.style.margin="0",i.appendChild(s),r.appendChild(i);var c,d=function(e){let t="";var n=new Uint8Array(e);for(let e=0;e<n.byteLength;e++)t+=String.fromCharCode(n[e]);return"data:image/png;base64,"+window.btoa(t)}(await t.arrayBuffer()),p=document.querySelector(".mb-4");p&&(c=p.querySelector("i.sci-delete-forever"))&&(c.click(),await new Promise(e=>setTimeout(e,300)));let e=1;var u=window.selectedScaleOption||"scale100";if("scale100"===u)e=1;else if("scale85"===u)e=.85;else if("scale75"===u)e=.75;else if("scaleCustom"===u){var m=document.querySelector('#scaling-options-container input[type="number"]'),y=parseFloat(m.value);if(!(!isNaN(y)&&50<=y&&y<=100))throw new Error("Invalid custom scale value.");e=y/100}var g=await async function(e,v){const w=new Image;return w.crossOrigin="Anonymous",w.src=e,new Promise((f,l)=>{w.onload=async()=>{try{var t=function(e){var n=document.createElement("canvas"),t=(n.width=e.width,n.height=e.height,n.getContext("2d"));t.drawImage(e,0,0);var l,o,a=(t=t.getImageData(0,0,n.width,n.height)).data;let r=null,i=null,s=null,c=null;for(let t=0;t<n.height;t++)for(let e=0;e<n.width;e++)0!==a[3+4*(t*n.width+e)]&&(null===r&&(r=t),i=t,(null===s||e<s)&&(s=e),null===c||e>c)&&(c=e);return null===r?{canvas:null,width:0,height:0}:(t=c-s+1,l=i-r+1,(o=document.createElement("canvas")).width=t,o.height=l,o.getContext("2d").drawImage(e,s,r,t,l,0,0,t,l),{canvas:o,width:t,height:l})}(w);if(!t.canvas)throw new Error("The uploaded image is fully transparent.");var n,o,a,r,i,s,c,d,p=Math.abs(t.width-4500)<=10&&Math.abs(t.height-5400)<=10;let e,l=(e=p&&1===v?t.canvas:((n=document.createElement("canvas")).width=4500,n.height=5400,(o=n.getContext("2d")).clearRect(0,0,n.width,n.height),a=4500*v,r=5370*v,i=Math.min(a/t.width,r/t.height),s=t.width*i,c=t.height*i,d=(4500-s)/2,o.drawImage(t.canvas,d,30,s,c),n),await new Promise((t,n)=>{e.toBlob(e=>{e?t(e):n(new Error("Canvas toBlob failed."))},"image/png",1)}));if(10485760<l.size){let e=1024,t=null,n=0;for(;n<5&&(n++,y=l,g=e,y=await y.arrayBuffer(),y=UPNG.decode(y),h=UPNG.toRGBA8(y)[0],h=UPNG.encode([h],y.width,y.height,g),!((t=await new Blob([h],{type:"image/png"})).size<=20971520||e<=128));)e=Math.floor(e/2);l=t}l=(u=l,m=300,await new Promise(o=>{var e=new Image;const a=URL.createObjectURL(u);e.crossOrigin="Anonymous",e.src=a,e.onload=async()=>{URL.revokeObjectURL(a);var e=await u.arrayBuffer(),t=new Uint8Array(e),n=[137,80,78,71,13,10,26,10];for(let e=0;e<n.length;e++)if(t[e]!==n[e])return void o(u);var e=Math.round(39.3701*m),e=new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e,e>>>24&255,e>>>16&255,e>>>8&255,255&e,1]),l=function(t){let n=-1;for(let e=0;e<t.length;e++)n=n>>>8^E[255&(n^t[e])];return(-1^n)>>>0}(e=new Uint8Array([112,72,89,115,...e])),e=new Uint8Array([0,0,0,9,...e,l>>>24&255,l>>>16&255,l>>>8&255,255&l]),e=((l=new Uint8Array(t.length+e.length)).set(t.slice(0,33),0),l.set(e,33),l.set(t.slice(33),33+e.length),new Blob([l],{type:"image/png"}));o(e)},e.onerror=()=>{URL.revokeObjectURL(a),o(u)}})),f(l)}catch(e){l(e)}var u,m,y,g,h},w.onerror=()=>{l()}})}(d,e),h=t.name.replace(/\.[^/.]+$/,"")+"_Snap.png",f=("true"===localStorage.getItem("downloadAfterProcessing")&&(o=h,l=URL.createObjectURL(g),(a=document.createElement("a")).href=l,a.download=o,document.body.appendChild(a),a.click(),document.body.removeChild(a),await!URL.revokeObjectURL(l)),g),v=t.name;if(f){var w=document.querySelector("div.dropzone-container");if(w=w&&w.querySelector('input[type="file"]'))try{var b=new DataTransfer,x=new File([f],v,{type:"image/png"}),C=(b.items.add(x),w.files=b.files,new Event("change",{bubbles:!0}));w.dispatchEvent(C)}catch{}}await 0,S(n)}catch{e(n),setTimeout(()=>S(n),2e3)}else e(n),setTimeout(()=>S(n),2e3)}function y(e,t){window.selectedScaleOption=e,localStorage.setItem("selectedScaleOption",e),(t=t.querySelector('input[type="number"]'))&&("scaleCustom"===e?(t.disabled=!1,t.style.cursor="text",(e=localStorage.getItem("customScaleValue"))&&(t.value=e),t.focus()):(t.disabled=!0,t.value="",t.style.cursor="not-allowed",t.style.borderColor="#ccc"),g())}function g(){var e,t=document.querySelector(".snap-upload-container .resize-btn");t&&("scaleCustom"===window.selectedScaleOption?(e=document.querySelector('#scaling-options-container input[type="number"]'))&&(e=parseFloat(e.value),isNaN(e)||e<50||100<e?(t.disabled=!0,t.style.cursor="not-allowed"):(t.disabled=!1,t.style.cursor="pointer")):["scale100","scale85","scale75"].includes(window.selectedScaleOption)?(t.disabled=!1,t.style.cursor="pointer"):(t.disabled=!0,t.style.cursor="not-allowed"))}function S(e){e.innerHTML="",e.style.borderColor="#470CED";var t=d();e.appendChild(t)}function e(e){e.innerHTML="",e.style.borderColor="#FF391F";var t=document.createElement("div");t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.gap="16px";const n=document.createElement("img");var l=chrome.runtime.getURL("assets/error.svg"),l=(n.src=l,n.alt="Error",n.style.width="40px",n.style.height="40px",n.onerror=()=>{n.style.display="none"},document.createElement("div")),o=document.createElement("p"),a=(o.textContent="Invalid File",o.style.fontSize="16px",o.style.color="#FF391F",o.style.fontWeight="bold",o.style.margin="0",document.createElement("p"));a.textContent="Upload a PNG file.",a.style.fontSize="14px",a.style.color="#9AA5B1",a.style.margin="0",l.appendChild(o),l.appendChild(a),t.appendChild(n),t.appendChild(l),e.appendChild(t)}}();