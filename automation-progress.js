const AutomationProgressUI=class{constructor(){this.container=null,this.fileName=null,this.statusText=null,this.spinner=null,this.completedIcon=null,this.counterBubble=null,this.percentText=null,this.progressFill=null,this.completedContainer=null,this.mainContent=null,this.isVisible=!1,this.createElements()}createElements(){this.container=document.createElement("div"),this.container.id="snap-automation-progress",Object.assign(this.container.style,{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",width:"994px",padding:"24px",backgroundColor:"#470CED",borderRadius:"10px",color:"#ffffff",fontFamily:"Amazon Ember, sans-serif",zIndex:"9999",display:"none"}),this.mainContent=document.createElement("div"),this.container.appendChild(this.mainContent);var e=this.createHeader(),e=(this.mainContent.appendChild(e),this.createProgress());this.mainContent.appendChild(e),this.completedContainer=this.createCompletedView(),this.container.appendChild(this.completedContainer),this.addStyles()}createHeader(){var e=document.createElement("div"),t=(Object.assign(e.style,{display:"flex",justifyContent:"space-between",marginBottom:"16px"}),document.createElement("div")),s=(t.style.display="flex",t.style.gap="32px",document.createElement("div")),n=document.createElement("div"),n=(n.textContent="Currently Processing",n.style.fontSize="14px",n.style.marginBottom="4px",this.fileName=document.createElement("div"),this.fileName.style.fontSize="13px",s.appendChild(n),s.appendChild(this.fileName),document.createElement("div")),i=document.createElement("div"),o=(i.textContent="Status",i.style.fontSize="14px",i.style.marginBottom="4px",document.createElement("div")),i=(o.style.display="flex",o.style.alignItems="center",o.style.gap="8px",this.spinner=document.createElement("div"),Object.assign(this.spinner.style,{width:"10px",height:"10px",border:"2px solid rgba(255,255,255,0.2)",borderTopColor:"#ffffff",borderRadius:"50%",animation:"spin 1s linear infinite"}),this.statusText=document.createElement("div"),this.statusText.style.fontSize="13px",o.appendChild(this.spinner),o.appendChild(this.statusText),n.appendChild(i),n.appendChild(o),t.appendChild(s),t.appendChild(n),document.createElement("div")),o=(i.style.display="flex",i.style.alignItems="center",i.style.gap="8px",document.createElement("div")),s=(Object.assign(o.style,{width:"26px",height:"26px",borderRadius:"50%",backgroundColor:"#3200C0",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"}),o.textContent="ü§ù",document.createElement("div"));return Object.assign(s.style,{backgroundColor:"#3200C0",borderRadius:"4px",padding:"6px 12px",fontSize:"12px"}),s.textContent="Avoid interacting with this tab to prevent automation from failing.",i.appendChild(o),i.appendChild(s),e.appendChild(t),e.appendChild(i),e}createProgress(){var e=document.createElement("div"),t=(e.style.marginTop="16px",document.createElement("div")),s=(t.style.display="flex",t.style.justifyContent="space-between",t.style.marginBottom="8px",document.createElement("div")),n=(s.style.display="flex",s.style.alignItems="center",s.style.gap="8px",document.createElement("div")),n=(n.textContent="Total Progress",n.style.fontSize="14px",this.counterBubble=document.createElement("div"),Object.assign(this.counterBubble.style,{backgroundColor:"#3700a8",borderRadius:"4px",padding:"2px 8px",fontSize:"12px"}),s.appendChild(n),s.appendChild(this.counterBubble),this.percentText=document.createElement("div"),this.percentText.style.fontSize="14px",t.appendChild(s),t.appendChild(this.percentText),document.createElement("div"));return Object.assign(n.style,{width:"100%",height:"5px",backgroundColor:"#ffffff",borderRadius:"4px",overflow:"hidden",marginTop:"8px"}),this.progressFill=document.createElement("div"),Object.assign(this.progressFill.style,{width:"0%",height:"100%",backgroundColor:"#01BB87",borderRadius:"4px",transition:"width 0.3s ease-in-out"}),n.appendChild(this.progressFill),e.appendChild(t),e.appendChild(n),e}createCompletedView(){var e=document.createElement("div"),t=(Object.assign(e.style,{display:"none",alignItems:"center",justifyContent:"center",gap:"8px",padding:"16px"}),document.createElement("img")),s=(t.src=chrome.runtime.getURL("assets/completed.svg"),t.style.width="24px",t.style.height="24px",document.createElement("div"));return s.textContent="Completed",s.style.fontSize="16px",e.appendChild(t),e.appendChild(s),e}addStyles(){var e=document.createElement("style");e.textContent=`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `,document.head.appendChild(e)}show(){this.isVisible||(document.body.appendChild(this.container),this.container.style.display="block",this.isVisible=!0)}hide(){this.isVisible&&(this.container.style.display="none",this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.isVisible=!1)}updateFileName(e){this.fileName&&(this.fileName.textContent=e)}updateStatus(e){this.statusText&&(this.statusText.textContent,"Completed"===(this.statusText.textContent=e)?(this.spinner&&(this.spinner.style.display="none"),this.completedIcon?this.completedIcon.style.display="block":(this.completedIcon=document.createElement("img"),this.completedIcon.src=chrome.runtime.getURL("assets/completed.svg"),this.completedIcon.style.width="14px",this.completedIcon.style.height="14px",this.spinner.parentNode.insertBefore(this.completedIcon,this.statusText))):(this.spinner&&(this.spinner.style.display="block"),this.completedIcon&&(this.completedIcon.style.display="none")))}updateProgress(s,n,i=!1,o=!1,a=null){if(this.counterBubble&&this.percentText&&this.progressFill){let e,t;if(a&&a.forceExact100Percent)t=100;else if(a&&void 0!==a.statusIndex&&void 0!==a.totalStatuses){var r=100/n,l=r/a.totalStatuses;let e;e=0===a.statusIndex?.05*r:a.isCompleted?r:a.statusIndex*l,100<=(t=(s-1)*r+e)&&!a.isCompleted&&(t=99.5),s===n&&a.isCompleted&&(t=100),s<n&&a.isCompleted&&(t=s*r)}else i||o?(l=100/n,e=Math.floor((s-1)/n*100),t=e+l,n<=s&&o&&(t=100),s<n&&o&&(t=s*l)):(e=(s-1)/n*100,a=.05*(100/n),t=e+a);this.counterBubble.textContent=Math.min(s,n)+"/"+n,this.percentText.textContent=Math.min(Math.round(t),100)+"%",this.progressFill.style.transition="width 0.5s ease-in-out",this.progressFill.style.width=Math.min(t,100)+"%",100<=t||75<=t?this.progressFill.style.backgroundColor="#01BB87":50<=t?this.progressFill.style.backgroundColor="#4CAF50":25<=t?this.progressFill.style.backgroundColor="#8BC34A":this.progressFill.style.backgroundColor="#01BB87"}}showCompleted(){this.mainContent&&this.completedContainer&&(this.mainContent.style.display="none",this.completedContainer.style.display="flex")}resetToNormal(){this.mainContent&&this.completedContainer&&(this.mainContent.style.display="block",this.completedContainer.style.display="none")}},automationProgressUI=new(window.AutomationProgressUI=AutomationProgressUI);function initializeProgressUI(){null!==new URLSearchParams(window.location.search).get("Snap")&&chrome.runtime.sendMessage({action:"getAutomationState"},e=>{var t;e&&e.success&&e.state&&(e=e.state).currentFile&&"completed"!==e.currentFile.status&&(automationProgressUI.show(),e.currentFile)&&(automationProgressUI.updateFileName(e.currentFile.filename||"Unknown file"),automationProgressUI.updateStatus("Uploading..."),t=void 0!==e.currentFile.index?e.currentFile.index+1:1,e=e.totalFiles||1,automationProgressUI.updateProgress(t,e))})}document.addEventListener("DOMContentLoaded",initializeProgressUI),"complete"!==document.readyState&&"interactive"!==document.readyState||initializeProgressUI(),chrome.runtime.onMessage.addListener((t,e,s)=>{if("updateAutomationProgress"===t.action){if(null===new URLSearchParams(window.location.search).get("Snap"))return s({success:!0}),!0;if(t.forceHide||t.isTabCompleted)return automationProgressUI.hide(),s({success:!0,action:"hide"}),!0;if(automationProgressUI.show(),t.filename&&automationProgressUI.updateFileName(t.filename),t.status&&automationProgressUI.updateStatus(t.status),t.currentFile&&t.totalFiles){var n,i=!0===t.updateProgressBar;let e=null;t.queueProgress&&((n=t.queueProgress).processed,n.total,n.current,n.total),t.statusInfo?(e=t.statusInfo,t.forceExact100Percent&&(e.forceExact100Percent=!0)):t.forceExact100Percent&&(e={forceExact100Percent:!0}),automationProgressUI.updateProgress(t.currentFile,t.totalFiles,i||t.isTabCompleted||!1,t.forceProgressUpdate||!1,e)}t.completed?automationProgressUI.showCompleted():automationProgressUI.resetToNormal(),s({success:!0,statusUpdated:t.status})}else if("hideAutomationProgress"===t.action)automationProgressUI.hide(),s({success:!0});else if("playCompletionSound"===t.action)if(t.isFinalTab){const o=chrome.runtime.getURL("assets/aut-completed.wav");let e=null;const a=()=>new Promise((e,t)=>{try{const s=document.createElement("audio");s.src=o,s.onended=()=>{document.body.removeChild(s),e(!0)},s.onerror=e=>{document.body.removeChild(s),t(e)},document.body.appendChild(s),s.play().catch(t)}catch(e){t(e)}});new Promise((t,s)=>{try{(e=new Audio(o)).play().then(t).catch(e=>{a().then(t).catch(s)})}catch(e){a().then(t).catch(s)}}).then(()=>{s({success:!0})}).catch(e=>{s({success:!1,error:e.toString()})})}else s({success:!0,skipped:!0});return!0});