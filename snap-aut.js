class SnapAutomation{constructor(){this.isProcessing=!1,this.currentFile=null,this.settings=null,this.retryCount=0,this.maxRetries=5,this.currentOperation=null,this.uploadComplete=!1,this.generatingImageCount=0,this.requiredGeneratingImageCount=1,this.lastClickedProduct=null,this.productSelectors={uploadContainer:".snap-upload-container",deleteIcon:".sci-icon.sci-delete-forever",generatingMessages:["Generating image....","Bild lädt....","Chargement de l'image....","Creando immagine....","Generando imagen....","画像を読み込み中...."],textFields:["#designCreator-productEditor-title","#designCreator-productEditor-brandName","#designCreator-productEditor-featureBullet1","#designCreator-productEditor-featureBullet2","#designCreator-productEditor-description"],copyEnToAll:{checkmark:".col-auto.pl-medium-large.pr-0.pt-1.ml-3.mb-0",container:".ng-star-inserted",findContainer:"snap-copy-find-container",copyBtn:"#copyBtn",pasteAllBtn:"#pasteAllBtn"},saveToDrafts:"button#draft-button"},this.initialize()}async initialize(){try{var e,o,t,s,l,c,r,i=new URLSearchParams(window.location.search).get("Snap");i&&(this.hideSnapBulkUploadButton(),[e,...o]=i.split("-"),o.join("-"))&&((t=await this.getAutomationState())&&t.isRunning?(this.currentFile=t.currentFile,this.settings=t.settings,console.log("",JSON.stringify({useNativeUploader:this.settings?.useNativeUploader,hasSettings:!!this.settings,settingsType:typeof this.settings})),console.log("",{filename:this.currentFile?.filename,hasBlobUrl:!!this.currentFile?.blobUrl,hasBase64:!!this.currentFile?.base64,blobUrlType:typeof this.currentFile?.blobUrl,fullState:t}),console.log(),await new Promise(o=>{chrome.runtime.sendMessage({action:"setActiveProgressTab"},e=>{e&&e.success?console.log():console.warn(),o()})}),this.settings?(console.log(),this.settings.clothingProducts?(s=!0===this.settings.clothingProducts.isActive,console.log("",s?"ACTIVE":"INACTIVE","Type:",typeof this.settings.clothingProducts.isActive),this.settings.clothingProducts.isActive=s):(console.warn(),this.settings.clothingProducts={isActive:!1}),this.settings.scalableProducts?(l=!0===this.settings.scalableProducts.isActive,console.log("",l?"ACTIVE":"INACTIVE","Type:",typeof this.settings.scalableProducts.isActive),this.settings.scalableProducts.isActive=l):(console.warn(),this.settings.scalableProducts={isActive:!1}),this.settings.tumblerProduct?(c=!0===this.settings.tumblerProduct.isActive,console.log("",c?"ACTIVE":"INACTIVE","Type:",typeof this.settings.tumblerProduct.isActive),this.settings.tumblerProduct.isActive=c):(console.warn(),this.settings.tumblerProduct={isActive:!1}),r=[],!0===this.settings.clothingProducts.isActive&&r.push("Clothing"),!0===this.settings.scalableProducts.isActive&&r.push("Scalable"),!0===this.settings.tumblerProduct.isActive&&r.push("Tumbler"),console.log()):(console.error(),this.settings={clothingProducts:{isActive:!1},scalableProducts:{isActive:!1},tumblerProduct:{isActive:!1}}),this.currentFile&&(this.currentFile.blobUrl||this.currentFile.base64)?(this.updateProgressUI("Uploading",!1),this.startAutomation()):console.error()):console.log())}catch(e){console.error(),this.handleError(e)}}async startAutomation(){try{if(this.isProcessing)console.log();else{if(this.isProcessing=!0,console.log(),this.updateProgressUI("Uploading",!1),!this.settings)throw console.error(),new Error;var e=[];!0===this.settings.clothingProducts?.isActive&&e.push("Clothing"),!0===this.settings.scalableProducts?.isActive&&e.push("Scalable"),!0===this.settings.tumblerProduct?.isActive&&e.push("Tumbler"),console.log(),console.log(),await this.waitForElement(this.productSelectors.uploadContainer),console.log(),await this.uploadFile(),console.log(),await this.waitForElement(this.productSelectors.deleteIcon),this.uploadComplete=!0,console.log(),console.log(),await this.sleep(500),this.updateProgressUI("Processing Products",!1),await this.processProducts(),console.log(),await this.sleep(500),await this.processActions(),console.log(),await this.sleep(500),console.log(),this.updateProgressUI("Completed",!0),this.isProcessing=!1,await this.processNextFile()}}catch(e){console.error(),this.handleError(e)}}async uploadFile(){try{console.log(),this.currentOperation="Uploading",this.updateProgressUI("Uploading",!1);var e=this.settings&&!0===this.settings.useNativeUploader;if(console.log("","","Settings value:",this.settings?.useNativeUploader,"Settings type:",typeof this.settings?.useNativeUploader,"Full settings object available:",!!this.settings),e){console.log("");var o=document.querySelector("div.dropzone-container");if(!o)throw new Error("");var t=o.querySelector('input[type="file"]');if(!t)throw new Error("");let e;if(this.currentFile.blobUrl)e=await this.blobUrlToFile(this.currentFile.blobUrl,this.currentFile.filename);else{if(!this.currentFile.base64)throw new Error("");e=this.base64ToFile(this.currentFile.base64,this.currentFile.filename)}var s=new DataTransfer,l=(s.items.add(e),t.files=s.files,new Event("change",{bubbles:!0}));t.dispatchEvent(l)}else{console.log("");var c=document.querySelector(this.productSelectors.uploadContainer);if(!c)throw new Error("");let e;if(this.currentFile.blobUrl)e=await this.blobUrlToFile(this.currentFile.blobUrl,this.currentFile.filename);else{if(!this.currentFile.base64)throw new Error("");e=this.base64ToFile(this.currentFile.base64,this.currentFile.filename)}var r=new DataTransfer,i=(r.items.add(e),new DragEvent("drop",{bubbles:!0,cancelable:!0,dataTransfer:r}));c.dispatchEvent(i)}console.log(),await this.sleep(500)}catch(e){throw console.error(),e}}async processProducts(){try{if(console.log(),!this.settings)throw console.error(),new Error;console.log(),console.log(),this.settings.clothingProducts&&!0===this.settings.clothingProducts.isActive?(console.log(),this.updateProgressUI("Processing Products",!1),await this.processClothingProducts(),console.log(),await this.sleep(1e3)):console.log(),this.settings.scalableProducts&&!0===this.settings.scalableProducts.isActive?(console.log(),this.updateProgressUI("Processing Scalable Products",!1),await this.processScalableProducts(),console.log(),await this.sleep(1e3)):console.log(),this.settings.tumblerProduct&&!0===this.settings.tumblerProduct.isActive?(console.log(),this.updateProgressUI("Processing TUMBLER",!1),await this.processTumblerProduct(),console.log(),await this.sleep(1e3)):console.log()}catch(e){throw console.error(),e}}async processActions(){try{console.log();var e=this.settings?.actions;e?(e.textSwap?(console.log(),this.updateProgressUI("Text Swap",!1),await this.processTextSwap(),console.log(),await this.sleep(1e3)):console.log(),e.copyEnToAll?(console.log(),this.updateProgressUI("Copy EN to All",!1),await this.processCopyEnToAll(),console.log(),await this.sleep(1e3)):console.log(),e.saveToDrafts?(console.log(),this.updateProgressUI("Save to Drafts",!1),await this.processSaveToDrafts(),console.log(),await this.sleep(1e3)):console.log()):console.log()}catch(e){throw console.error(),e}}async processTextSwap(){try{console.log(),this.updateProgressUI("Text Swap",!1);var e=this.cleanFilenameForTextSwap(this.currentFile.filename);console.log();for(const l of this.productSelectors.textFields){var o,t,s=document.querySelector(l);s&&(console.log(),t=(o=s.value).replace(/#snap/g,e),o!==t)?(console.log(),s.value=t,s.dispatchEvent(new Event("input",{bubbles:!0})),console.log(),await this.sleep(250)):console.log()}console.log(),await this.sleep(400),console.log()}catch(e){throw console.error(),e}}async processCopyEnToAll(){try{console.log(),this.updateProgressUI("Copy EN to All",!1),console.log();var e,o,t,s,l=document.querySelector(this.productSelectors.copyEnToAll.checkmark);l?(console.log(),l.click(),console.log(),await this.sleep(300),console.log(),(e=document.querySelector("snap-copy-find-container"))&&(console.log(),o=e.shadowRoot)?(console.log(),console.log(),(t=o.querySelector("#copyBtn"))&&(console.log(),t.click(),console.log(),await this.sleep(300),console.log(),s=o.querySelector("#pasteAllBtn"))?(console.log(),s.click(),console.log(),await this.sleep(1500)):console.log()):(console.log(),this.tryFallbackCopyPasteMethod())):console.log(),console.log()}catch(e){throw console.error(),e}}async tryFallbackCopyPasteMethod(){var e,o;console.log();let t=!1;for(const c of document.querySelectorAll("*"))if(c.shadowRoot){console.log();var s=c.shadowRoot,l=s.querySelector("#copyBtn");if(l){console.log(),l.click(),await this.sleep(300);l=s.querySelector("#pasteAllBtn");if(l){console.log(),l.click(),await this.sleep(1500),t=!0;break}}}t||(console.log(),(e=document.querySelector(this.productSelectors.copyEnToAll.container)?.querySelector(this.productSelectors.copyEnToAll.findContainer))&&(console.log(),o=e.querySelector(this.productSelectors.copyEnToAll.copyBtn))&&(console.log(),o.click(),console.log(),await this.sleep(300),console.log(),o=e.querySelector(this.productSelectors.copyEnToAll.pasteAllBtn))?(console.log(),o.click(),console.log(),await this.sleep(1500)):console.log())}async processSaveToDrafts(){try{console.log(),this.updateProgressUI("Save to Drafts",!1),console.log();var e=document.querySelector(this.productSelectors.saveToDrafts);e&&(console.log(),e.click(),console.log(),await this.sleep(1e3)),console.log()}catch(e){throw console.error(),e}}async processClothingProducts(){try{console.log();var o=this.settings.clothingProducts;if(o&&!0===o.isActive){const L=["STANDARD_TSHIRT","PREMIUM_TSHIRT","VNECK","TANK_TOP","STANDARD_LONG_SLEEVE","RAGLAN","STANDARD_SWEATSHIRT"];var e=[...L,"STANDARD_PULLOVER_HOODIE","ZIP_HOODIE"],t={},s=new Set;for(const H of e){var l,c,r,i=`.${H}-edit-btn`,n=document.querySelector(i);n?(l=n.disabled||n.classList.contains("disabled"),r=(c=n.closest(".product-card"))&&c.classList.contains("disabled"),l||r?(console.log(),s.add(H)):(t[H]=n,console.log())):console.log()}console.log();var a=o.allProducts&&"Skip"!==o.allProducts.colors,d=o.allProducts&&"Skip"!==o.allProducts.prices,u=new Set;if(o.shirts&&("Default (Front)"!==o.shirts.sidesOptions||o.shirts.colors&&"Skip"!==o.shirts.colors||o.shirts.prices&&"Skip"!==o.shirts.prices)){console.log();let e=0;var g=Object.keys(t).filter(e=>L.includes(e));console.log();for(const N of g)try{console.log();var p=t[N],h=p.disabled||p.classList.contains("disabled"),m=p.closest(".product-card"),S=m&&m.classList.contains("disabled");h||S?console.log():(console.log(),this.updateProgressUI("Processing "+N,!1),p.click(),console.log(),await this.sleep(1200),o.shirts.colors&&"Skip"!==o.shirts.colors?(console.log(),await this.processProductColors(o.shirts.colors),console.log(),await this.sleep(250)):a&&(console.log(),await this.processProductColors(o.allProducts.colors),console.log(),await this.sleep(250)),o.shirts.prices&&"Skip"!==o.shirts.prices?(console.log(),await this.processProductPrices(o.shirts.prices),console.log(),await this.sleep(250)):d&&(console.log(),await this.processProductPrices(o.allProducts.prices),console.log(),await this.sleep(250)),"Default (Front)"!==o.shirts.sidesOptions&&(console.log(),await this.processProductSides(N,o.shirts.sidesOptions),console.log(),await this.sleep(500)),u.add(N),++e<g.length&&(console.log(),await this.sleep(1e3)))}catch(e){console.error(),console.log()}console.log()}else if(a||d){console.log();var P=Object.keys(t).filter(e=>L.includes(e));for(let e=0;e<P.length;e++){var b=P[e];try{console.log();var y=t[b],w=y.disabled||y.classList.contains("disabled"),A=y.closest(".product-card"),E=A&&A.classList.contains("disabled");w||E?console.log():(console.log(),this.updateProgressUI("Processing "+b,!1),y.click(),console.log(),await this.sleep(1200),a&&(console.log(),await this.processProductColors(o.allProducts.colors),console.log(),await this.sleep(250)),d&&(console.log(),await this.processProductPrices(o.allProducts.prices),console.log(),await this.sleep(250)),u.add(b),e<P.length-1&&(console.log(),await this.sleep(1e3)))}catch(e){console.error(),console.log()}}}else console.log();if(o.pulloverHoodie&&("Default (Front)"!==o.pulloverHoodie.sidesOptions||o.pulloverHoodie.colors&&"Skip"!==o.pulloverHoodie.colors||o.pulloverHoodie.prices&&"Skip"!==o.pulloverHoodie.prices)&&t.STANDARD_PULLOVER_HOODIE&&!u.has("STANDARD_PULLOVER_HOODIE"))try{console.log();var T=t.STANDARD_PULLOVER_HOODIE,v=T.disabled||T.classList.contains("disabled"),f=T.closest(".product-card"),O=f&&f.classList.contains("disabled");v||O?console.log():(console.log(),this.updateProgressUI("Processing STANDARD_PULLOVER_HOODIE",!1),T.click(),console.log(),await this.sleep(1200),o.pulloverHoodie.colors&&"Skip"!==o.pulloverHoodie.colors?(console.log(),await this.processProductColors(o.pulloverHoodie.colors),console.log(),await this.sleep(250)):a&&(console.log(),await this.processProductColors(o.allProducts.colors),console.log(),await this.sleep(250)),o.pulloverHoodie.prices&&"Skip"!==o.pulloverHoodie.prices?(console.log(),await this.processProductPrices(o.pulloverHoodie.prices),console.log(),await this.sleep(250)):d&&(console.log(),await this.processProductPrices(o.allProducts.prices),console.log(),await this.sleep(250)),"Default (Front)"!==o.pulloverHoodie.sidesOptions&&(console.log(),await this.processProductSides("STANDARD_PULLOVER_HOODIE",o.pulloverHoodie.sidesOptions),console.log(),await this.sleep(500)),u.add("STANDARD_PULLOVER_HOODIE"))}catch(e){console.error()}else if(t.STANDARD_PULLOVER_HOODIE&&!u.has("STANDARD_PULLOVER_HOODIE")&&(a||d))try{console.log();var C=t.STANDARD_PULLOVER_HOODIE,q=C.disabled||C.classList.contains("disabled"),D=C.closest(".product-card"),F=D&&D.classList.contains("disabled");q||F?console.log():(console.log(),this.updateProgressUI("Processing STANDARD_PULLOVER_HOODIE",!1),C.click(),console.log(),await this.sleep(1200),a&&(console.log(),await this.processProductColors(o.allProducts.colors),console.log(),await this.sleep(250)),d&&(console.log(),await this.processProductPrices(o.allProducts.prices),console.log(),await this.sleep(250)),u.add("STANDARD_PULLOVER_HOODIE"))}catch(e){console.error()}else s.has("STANDARD_PULLOVER_HOODIE")||t.STANDARD_PULLOVER_HOODIE&&!u.has("STANDARD_PULLOVER_HOODIE")||u.has("STANDARD_PULLOVER_HOODIE"),console.log();if(o.zipHoodie&&("Default (Front)"!==o.zipHoodie.sidesOptions||o.zipHoodie.colors&&"Skip"!==o.zipHoodie.colors||o.zipHoodie.prices&&"Skip"!==o.zipHoodie.prices)&&t.ZIP_HOODIE&&!u.has("ZIP_HOODIE"))try{console.log();var k=t.ZIP_HOODIE,U=k.disabled||k.classList.contains("disabled"),I=k.closest(".product-card"),M=I&&I.classList.contains("disabled");U||M?console.log():(console.log(),this.updateProgressUI("Processing ZIP_HOODIE",!1),k.click(),console.log(),await this.sleep(1200),o.zipHoodie.colors&&"Skip"!==o.zipHoodie.colors?(console.log(),await this.processProductColors(o.zipHoodie.colors),console.log(),await this.sleep(250)):a&&(console.log(),await this.processProductColors(o.allProducts.colors),console.log(),await this.sleep(250)),o.zipHoodie.prices&&"Skip"!==o.zipHoodie.prices?(console.log(),await this.processProductPrices(o.zipHoodie.prices),console.log(),await this.sleep(250)):d&&(console.log(),await this.processProductPrices(o.allProducts.prices),console.log(),await this.sleep(250)),"Default (Front)"!==o.zipHoodie.sidesOptions&&(console.log(),await this.processProductSides("ZIP_HOODIE",o.zipHoodie.sidesOptions),console.log(),await this.sleep(500)),u.add("ZIP_HOODIE"))}catch(e){console.error()}else if(t.ZIP_HOODIE&&!u.has("ZIP_HOODIE")&&(a||d))try{console.log();var _=t.ZIP_HOODIE,x=_.disabled||_.classList.contains("disabled"),R=_.closest(".product-card"),B=R&&R.classList.contains("disabled");x||B?console.log():(console.log(),this.updateProgressUI("Processing ZIP_HOODIE",!1),_.click(),console.log(),await this.sleep(1200),a&&(console.log(),await this.processProductColors(o.allProducts.colors),console.log(),await this.sleep(250)),d&&(console.log(),await this.processProductPrices(o.allProducts.prices),console.log(),await this.sleep(250)),u.add("ZIP_HOODIE"))}catch(e){console.error()}else s.has("ZIP_HOODIE")||t.ZIP_HOODIE&&!u.has("ZIP_HOODIE")||u.has("ZIP_HOODIE"),console.log();console.log()}console.log()}catch(e){console.error()}}async processProductSides(t,s){try{console.log(),this.updateProgressUI("Processing "+t,!1);let e,o=!1;var l;"Back"===s?(e=Array.from(document.querySelectorAll(".tab-button")).find(e=>"Back"===e.textContent.trim()),console.log()):"Frontside (Pocket)"===s?(e=Array.from(document.querySelectorAll(".tab-button")).find(e=>e.textContent.trim().includes("Pocket")),console.log()):"Back & Pocket"===s&&(e=Array.from(document.querySelectorAll(".tab-button")).find(e=>e.textContent.trim().includes("Back & Pocket")),console.log(),o=!0),e?(e.classList.contains("active")?console.log():(console.log(),e.click(),console.log(),await this.sleep(500)),console.log(),l=await this.waitForElement(".resize-btn:not([disabled])"),console.log(),l.click(),o?(console.log(),await this.waitForBackAndPocketMessages()):(console.log(),await this.sleep(1500),console.log(),await this.waitForAnyGeneratingMessage(),console.log(),await this.sleep(150)),console.log()):console.log()}catch(e){console.error()}}async processProductColors(o){try{console.log(),this.currentOperation="processProductColors";var e=null!==document.querySelector(".product-editor");if(console.log(),e)console.log();else{console.log();let e=null,o=null;for(const c of["STANDARD_TSHIRT","PREMIUM_TSHIRT","VNECK","TANK_TOP","STANDARD_LONG_SLEEVE","RAGLAN","STANDARD_SWEATSHIRT","STANDARD_PULLOVER_HOODIE","ZIP_HOODIE"]){var t=document.querySelector(`.${c}-edit-btn`);if(t&&!t.disabled&&!t.classList.contains("disabled")){var s=t.closest(".product-card");if(!(s&&s.classList.contains("disabled"))){e=t,o=c;break}}}if(!e)return void console.error();console.log(),"STANDARD_TSHIRT"===o?this.lastClickedProduct="Standard T-shirt":"PREMIUM_TSHIRT"===o?this.lastClickedProduct="Premium T-shirt":"VNECK"===o?this.lastClickedProduct="V-neck":"TANK_TOP"===o?this.lastClickedProduct="Tank Top":"STANDARD_LONG_SLEEVE"===o?this.lastClickedProduct="Long Sleeve":"RAGLAN"===o?this.lastClickedProduct="Raglan":"STANDARD_SWEATSHIRT"===o?this.lastClickedProduct="Sweatshirt":"STANDARD_PULLOVER_HOODIE"===o?this.lastClickedProduct="Pullover Hoodie":"ZIP_HOODIE"===o&&(this.lastClickedProduct="Zip Hoodie"),this.updateProgressUI("Processing "+o,!1),console.log(),e.click(),console.log(),await this.sleep(1200)}console.log();var l=await this.waitForElement(".color-groups-container");if(l)if(console.log(),document.querySelector(".product-color-actions")){let e;"Dark Colors"===o?(e=document.querySelector("#product-dark-colors-btn"),console.log()):"Light Colors"===o?(e=document.querySelector("#product-light-colors-btn"),console.log()):"All Colors"===o&&(e=document.querySelector("#product-all-colors-btn"),console.log()),(e||(console.log(),"Dark Colors"===o?(e=document.querySelector('button[id="product-dark-colors-btn"]'),console.log()):"Light Colors"===o?(e=document.querySelector('button[id="product-light-colors-btn"]'),console.log()):"All Colors"===o&&(e=document.querySelector('button[id="product-all-colors-btn"]'),console.log()),e))&&(console.log(),e.click(),console.log(),await this.sleep(300)),console.log()}else console.error();else console.error()}catch(e){console.error()}}async processProductPrices(e){try{console.log(),this.currentOperation="processProductPrices";var o=null!==document.querySelector(".product-editor");if(console.log(),o)console.log();else{console.log();let e=null,o=null;for(const i of["STANDARD_TSHIRT","PREMIUM_TSHIRT","VNECK","TANK_TOP","STANDARD_LONG_SLEEVE","RAGLAN","STANDARD_SWEATSHIRT","STANDARD_PULLOVER_HOODIE","ZIP_HOODIE"]){var t=document.querySelector(`.${i}-edit-btn`);if(t&&!t.disabled&&!t.classList.contains("disabled")){var s=t.closest(".product-card");if(!(s&&s.classList.contains("disabled"))){e=t,o=i;break}}}if(!e)return void console.error();console.log(),"STANDARD_TSHIRT"===o?this.lastClickedProduct="Standard T-shirt":"PREMIUM_TSHIRT"===o?this.lastClickedProduct="Premium T-shirt":"VNECK"===o?this.lastClickedProduct="V-neck":"TANK_TOP"===o?this.lastClickedProduct="Tank Top":"STANDARD_LONG_SLEEVE"===o?this.lastClickedProduct="Long Sleeve":"RAGLAN"===o?this.lastClickedProduct="Raglan":"STANDARD_SWEATSHIRT"===o?this.lastClickedProduct="Sweatshirt":"STANDARD_PULLOVER_HOODIE"===o?this.lastClickedProduct="Pullover Hoodie":"ZIP_HOODIE"===o&&(this.lastClickedProduct="Zip Hoodie"),this.updateProgressUI("Processing "+o,!1),console.log(),e.click(),console.log(),await this.sleep(750)}if(console.log(),await this.waitForElement(".product-price-actions")){console.log();let s;if("Default Prices"===e?(s=document.querySelector("#product-default-prices-btn"),console.log()):"Suggested Prices"===e?(s=document.querySelector("#product-suggested-prices-btn"),console.log()):"Market Average"===e?(s=document.querySelector("#product-market-average-btn"),console.log()):"Max Prices"===e&&(s=document.querySelector("#product-max-prices-btn"),console.log()),s||(console.log(),"Default Prices"===e?(s=document.querySelector('button[id="product-default-prices-btn"]'),console.log()):"Suggested Prices"===e?(s=document.querySelector('button[id="product-suggested-prices-btn"]'),console.log()):"Market Average"===e?(s=document.querySelector('button[id="product-market-average-btn"]'),console.log()):"Max Prices"===e&&(s=document.querySelector('button[id="product-max-prices-btn"]'),console.log()),s)){var l=s.id;console.log(),console.log(),s.click(),console.log();let e=!1,o=0;for(;!e&&o<10;){await this.sleep(200);var c=document.querySelector("#"+l);c&&(e=c.disabled||c.classList.contains("disabled")||null!==c.getAttribute("disabled"))&&console.log(),o++}console.log();let t=!1;o=0;for(;!t&&o<30;){await this.sleep(300);var r=document.querySelector("#"+l);r&&(t=!r.disabled&&!r.classList.contains("disabled")&&null===r.getAttribute("disabled"))&&console.log(),o++}t||console.log(),console.log(),await this.sleep(250)}console.log()}else console.error()}catch(e){console.error()}}async processScalableProducts(){try{console.log();var e=this.settings.scalableProducts;if(e&&!0===e.isActive)for(const c of["POP_SOCKET","PHONE_CASE_APPLE_IPHONE","TOTE_BAG","THROW_PILLOW"]){console.log();var o,t,s,l=document.querySelector(`.${c}-edit-btn`);!l||(console.log(),!("Skip"!==e.scale||"Default (White)"!==e.color||"Skip"!==e.prices))||(console.log(),o=l.disabled||l.classList.contains("disabled"),s=(t=l.closest(".product-card"))&&t.classList.contains("disabled"),o)||s?console.log():("POP_SOCKET"===c?this.lastClickedProduct="POP_SOCKET":"PHONE_CASE_APPLE_IPHONE"===c?this.lastClickedProduct="PHONE_CASE":"TOTE_BAG"===c?this.lastClickedProduct="TOTE_BAG":"THROW_PILLOW"===c?this.lastClickedProduct="THROW_PILLOW":this.lastClickedProduct=c,this.updateProgressUI("Processing "+this.lastClickedProduct,!1),console.log(),l.click(),console.log(),await this.sleep(750),"Skip"!==e.scale&&(console.log(),await this.processScalableProductScaleWithoutEdit(c,e.scale,e.customScale),console.log(),await this.sleep(250)),"Default (White)"!==e.color&&(console.log(),await this.processScalableProductColorWithoutEdit(c,e.color,e.customColor),console.log(),await this.sleep(250)),"Skip"!==e.prices&&(console.log(),await this.processScalableProductPricesWithoutEdit(c,e.prices),console.log(),await this.sleep(250)))}console.log()}catch(e){console.error()}}async processScalableProductScaleWithoutEdit(e,o,t){try{console.log(),this.currentOperation="processScalableProductScale",console.log();let e;if("Keep current"===o)console.log();else if("Custom scale"===o){console.log();var s,l=document.querySelector('input#custom[type="radio"]');if((e=l||(console.log(),document.querySelector('input[type="radio"][id*="custom"], input[type="radio"][value*="custom"]')))&&(console.log(),e.click(),console.log(),await this.sleep(1e3),t)){console.log();let e=document.querySelector('input[type="number"]:not([disabled])');e||(console.log(),(e=document.querySelector('input[type="number"]'))&&e.disabled&&(console.log(),e.removeAttribute("disabled"),await this.sleep(500))),e||(console.log(),s=[document.querySelector("input.custom-scale-input"),document.querySelector("input.scale-input"),document.querySelector("input.scale-value"),document.querySelector('input[placeholder*="scale"], input[placeholder*="Scale"]'),document.querySelector('input:not([type="radio"])[id*="scale"], input:not([type="radio"])[id*="Scale"]'),document.querySelector('input:not([type="radio"]):not([type="checkbox"]).ng-untouched'),document.querySelector('input[min="50"][max="100"]'),document.querySelector('input[style*="border-bottom: 2px solid"]')],e=s.find(e=>null!==e)),e&&(console.log(),e.disabled&&(console.log(),e.disabled=!1,e.removeAttribute("disabled")),console.log(),e.focus(),await this.sleep(300),console.log(),e.value="",e.dispatchEvent(new Event("input",{bubbles:!0})),await this.sleep(300),console.log(),e.value=t,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),console.log(),e.blur(),await this.sleep(300)),console.log()}}else"100%"===o?(console.log(),(e=document.querySelector("input#percent100"))&&e.click()):"85%"===o?(console.log(),(e=document.querySelector("input#percent85"))&&e.click()):"75%"===o?(console.log(),(e=document.querySelector("input#percent75"))&&e.click()):"Pattern"===o&&(console.log(),e=document.querySelector("input#pattern"))&&e.click();if(e||"Keep current"===o){"Keep current"!==o&&(console.log(),await this.sleep(1e3)),console.log();var c=await this.waitForElement(".resize-btn:not([disabled])");if(c)console.log(),c.click();else{console.log();var r=[document.querySelector("button.resize-btn"),document.querySelector('button[class*="resize"]'),document.querySelector('button:contains("Resize")'),document.querySelector('button:contains("Apply")')].find(e=>null!==e&&!e.disabled);if(!r)return void console.log();console.log(),r.click()}console.log(),await this.sleep(3e3),console.log(),await this.waitForElement(".delete-button"),console.log(),await this.sleep(150)}console.log()}catch(e){console.error()}}async processScalableProductColorWithoutEdit(e,o,t){try{if(console.log(),this.currentOperation="processScalableProductColor","Default (White)"===o);else{if(console.log(),await this.waitForElement(".delete-button"),console.log(),console.log(),"Custom Color"===o&&t)console.log(),await this.applyCustomColorToProduct(t);else{console.log();var s=document.querySelectorAll(".color-swatch");let t;var l,c={Black:"#000000","Dark Red":"#840A08",Crimson:"#C70010","Vivid Orange":"#F36900","Bright Yellow":"#FEC600","Kelly Green":"#01B62F","Forest Green":"#1C8C46","Dark Olive":"#37602B","Sky Blue":"#1AB7EA","Royal Blue":"#002BB6",Purple:"#5C2D91","Hot Pink":"#E0218A","Pale Pink":"#E9CDDB",Brown:"#7B4A1B",Gray:"#979797"}[o];if(c){console.log();for(const u of s){var r=window.getComputedStyle(u).backgroundColor,i=this.rgbToHex(r);if(console.log(),i.toLowerCase()===c.toLowerCase()){t=u,console.log();break}}if(!t){console.log();let e=null,o=Number.MAX_VALUE;for(const g of s){var n=window.getComputedStyle(g).backgroundColor,a=this.rgbToHex(n),d=this.calculateColorDistance(a,c);console.log(),d<o&&(o=d,e=g)}e&&(t=e,l=window.getComputedStyle(e),this.rgbToHex(l.backgroundColor),console.log())}t?(console.log(),t.click()):console.log()}}console.log(),await this.sleep(1500)}console.log()}catch(e){console.error()}}async processScalableProductPricesWithoutEdit(e,o){try{if(console.log(),this.currentOperation="processScalableProductPrices",console.log(),await this.waitForElement(".product-price-actions")){console.log();let s;if("Default Prices"===o?(s=document.querySelector("#product-default-prices-btn"),console.log()):"Suggested Prices"===o?(s=document.querySelector("#product-suggested-prices-btn"),console.log()):"Market Average"===o?(s=document.querySelector("#product-market-average-btn"),console.log()):"Max Prices"===o&&(s=document.querySelector("#product-max-prices-btn"),console.log()),s||(console.log(),"Default Prices"===o?(s=document.querySelector('button[id="product-default-prices-btn"]'),console.log()):"Suggested Prices"===o?(s=document.querySelector('button[id="product-suggested-prices-btn"]'),console.log()):"Market Average"===o?(s=document.querySelector('button[id="product-market-average-btn"]'),console.log()):"Max Prices"===o&&(s=document.querySelector('button[id="product-max-prices-btn"]'),console.log()),s)){var l=s.id;console.log(),console.log(),s.click(),console.log();let e=!1,o=0;for(;!e&&o<10;){await this.sleep(200);var c=document.querySelector("#"+l);c&&(e=c.disabled||c.classList.contains("disabled")||null!==c.getAttribute("disabled"))&&console.log(),o++}console.log();let t=!1;o=0;for(;!t&&o<30;){await this.sleep(300);var r=document.querySelector("#"+l);r&&(t=!r.disabled&&!r.classList.contains("disabled")&&null===r.getAttribute("disabled"))&&console.log(),o++}t||console.log(),console.log(),await this.sleep(250)}}console.log()}catch(e){console.error()}}async applyCustomColorToProduct(o){console.log();o=o.replace("#","").toUpperCase();console.log();try{console.log();var t=document.querySelector(["button#color-btn.btn.btn-secondary.icon",'button.btn.btn-secondary.icon[id*="color"]','button.btn-secondary.icon[id*="color"]'].join(","));if(t){this.addColorPickerHidingCSS(),console.log(),console.log(),t.click(),console.log(),await this.sleep(1e3),console.log();let e=document.querySelector('.sketch-picker, div[class*="sketch-picker"]');if(!e){if(console.log(),await this.sleep(1e3),!(e=document.querySelector('.sketch-picker, div[class*="sketch-picker"]')))throw new Error;console.log()}console.log();var s=e.querySelector(".sketch-fields input");if(s)return console.log(),console.log(),s.value="",s.dispatchEvent(new Event("input",{bubbles:!0})),await this.sleep(100),console.log(),s.value=o,s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0})),await this.sleep(200),console.log(),s.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",code:"Enter",keyCode:13,bubbles:!0,cancelable:!0})),await this.sleep(100),s.dispatchEvent(new KeyboardEvent("keyup",{key:"Enter",code:"Enter",keyCode:13,bubbles:!0,cancelable:!0})),await this.sleep(500),await this.cleanupAfterColorApplication(),console.log(),!0}throw new Error}catch(e){throw this.removeColorPickerHidingCSS(),console.error(),e}}addColorPickerHidingCSS(){var e;document.getElementById("temp-hide-color-picker-style")||((e=document.createElement("style")).id="temp-hide-color-picker-style",e.textContent=`

                body.temp-hide-color-picker .sketch-picker,
                body.temp-hide-color-picker .popover.color-picker-popover,
                body.temp-hide-color-picker ngb-popover-window[class*="color-picker-popover"] {
                    position: absolute !important;
                    visibility: hidden !important;
                    opacity: 0 !important;
                    pointer-events: none !important;
                    height: 0 !important;
                    overflow: hidden !important;
                    margin: 0 !important;
                    padding: 0 !important;
                    border: none !important;
                    width: 0 !important;
                }

                body.temp-hide-color-picker .popover.color-picker-popover .arrow,
                body.temp-hide-color-picker ngb-popover-window[class*="color-picker-popover"] .arrow {
                    display: none !important;
                }

                .sketch-picker input {
                    pointer-events: auto !important;
                }
            `,document.head.appendChild(e)),document.body.classList.add("temp-hide-color-picker")}removeColorPickerHidingCSS(){document.body.classList.remove("temp-hide-color-picker"),console.log()}async cleanupAfterColorApplication(){console.log(),document.body.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0})),await this.sleep(100),this.removeColorPickerHidingCSS(),console.log()}async processTumblerProduct(){try{console.log();var e,o,t,s,l=this.settings.tumblerProduct;l&&!0===l.isActive?(("Default (One Side)"!==l.sides||"100%"!==l.scale||"Skip"!==l.colors||"Skip"!==l.prices)&&(console.log(),e=document.querySelector(".TUMBLER-edit-btn"))&&(o=e.disabled||e.classList.contains("disabled"),s=(t=e.closest(".product-card"))&&t.classList.contains("disabled"),o||s||(console.log(),this.lastClickedProduct="TUMBLER",this.updateProgressUI("Processing TUMBLER",!1),e.click(),console.log(),await this.sleep(750),"Skip"!==l.colors?(console.log(),await this.processTumblerColors(l.colors),console.log(),await this.sleep(250)):console.log(),"Skip"!==l.prices?(console.log(),await this.processTumblerPrices(l.prices),console.log(),await this.sleep(250)):console.log(),console.log(),await this.processTumblerScale(l.scale,l.customScale),console.log(),await this.sleep(250),"Default (One Side)"!==l.sides?(console.log(),await this.processTumblerSides(l.sides),console.log(),await this.sleep(500)):console.log())),console.log()):console.log()}catch(e){console.error()}}async getAutomationState(){return new Promise(o=>{chrome.runtime.sendMessage({action:"getAutomationState"},e=>{e&&e.success&&e.state?o(e.state):o(null)})})}async processNextFile(){try{console.log(),console.log();let t=!1;await new Promise(o=>{chrome.runtime.sendMessage({action:"getAutomationState"},e=>{e&&e.success&&e.state?(e=e.state).currentFile&&e.currentFile.filename===this.currentFile?.filename&&"completed"===e.currentFile.status?(console.log(),t=!0):console.log():console.warn(),o()})}),t||(console.log(),await new Promise(o=>{chrome.runtime.sendMessage({action:"markTabCompleted",filename:this.currentFile?.filename},e=>{e&&e.success?(console.log(),t=!0):console.warn(),o()})}));var e=await this.getAutomationState();const s=e&&e.totalFiles&&e.processedFiles&&e.processedFiles.length+1>=e.totalFiles,l=(console.log(),this.currentFile?.index+1||1),c=e?.totalFiles||this.settings?.totalFiles||0;var o=100/c;l;console.log();const r={status:"Completed",statusIndex:21,totalStatuses:22,isCompleted:!0};return(console.log(),await new Promise(o=>{chrome.runtime.sendMessage({action:"updateAutomationProgress",status:"Completed",filename:this.currentFile?.filename,currentFile:l,totalFiles:c,isTabCompleted:!1,updateProgressOnly:!0,updateProgressBar:!0,forceProgressUpdate:!0,completed:s,statusInfo:r},e=>{console.log(),o()})}),console.log(),await this.sleep(250),s)?(console.log(),await this.sleep(1e3),console.log(),await new Promise(o=>{chrome.runtime.sendMessage({action:"hideAllProgressUI"},e=>{console.log(),o()})}),!0):(console.log(),await new Promise(o=>{chrome.runtime.sendMessage({action:"processNextFile",waitForCompletion:!0},e=>{e&&e.success?console.log():console.warn(),o(e&&e.success)})}))}catch(e){throw console.error(),e}}updateProgressUI(e,s=!1){console.log();var o=["Uploading...","Processing Products","Processing Design","Processing STANDARD_TSHIRT","Processing PREMIUM_TSHIRT","Processing VNECK","Processing TANK_TOP","Processing STANDARD_LONG_SLEEVE","Processing RAGLAN","Processing STANDARD_PULLOVER_HOODIE","Processing ZIP_HOODIE","Processing STANDARD_SWEATSHIRT","Processing POP_SOCKET","Processing PHONE_CASE","Processing TOTE_BAG","Processing THROW_PILLOW","Processing TUMBLER","Processing Scalable Products","Actions: Text Swap","Actions: Copy EN to All","Actions: Save to Drafts","Completed"];let l=e;"Uploading"===e?l="Uploading...":"Completed"===e?l="Completed":"Text Swap"===e?l="Actions: Text Swap":"Copy EN to All"===e?l="Actions: Copy EN to All":"Save to Drafts"===e?l="Actions: Save to Drafts":e.startsWith("Processing ")?l=e.includes("STANDARD_TSHIRT")?"Processing STANDARD_TSHIRT":e.includes("PREMIUM_TSHIRT")?"Processing PREMIUM_TSHIRT":e.includes("VNECK")?"Processing VNECK":e.includes("TANK_TOP")?"Processing TANK_TOP":e.includes("STANDARD_LONG_SLEEVE")?"Processing STANDARD_LONG_SLEEVE":e.includes("RAGLAN")?"Processing RAGLAN":e.includes("STANDARD_PULLOVER_HOODIE")?"Processing STANDARD_PULLOVER_HOODIE":e.includes("ZIP_HOODIE")?"Processing ZIP_HOODIE":e.includes("STANDARD_SWEATSHIRT")?"Processing STANDARD_SWEATSHIRT":e.includes("POP_SOCKET")?"Processing POP_SOCKET":e.includes("PHONE_CASE")?"Processing PHONE_CASE":e.includes("TOTE_BAG")?"Processing TOTE_BAG":e.includes("THROW_PILLOW")?"Processing THROW_PILLOW":e.includes("TUMBLER")?"Processing TUMBLER":this.currentOperation?this.lastClickedProduct?"Processing "+this.lastClickedProduct:this.currentOperation.includes("Tumbler")?"Processing TUMBLER":this.currentOperation.includes("Scalable")?"Processing POP_SOCKET":"Processing Design":"Processing Design":"Processing Products"===e&&(l="Processing Products"),console.log();e=o.indexOf(l);const c={status:l,statusIndex:-1!==e?e:0,totalStatuses:o.length,isCompleted:"Completed"===l},r=(console.log(),"Completed"===l);chrome.runtime.sendMessage({action:"getAutomationState"},e=>{if(e&&e.success&&e.state){e=e.state;const o=e.totalFiles||this.settings?.totalFiles||0;e=e.processedFiles?.length||0;const t=void 0!==this.currentFile?.index?this.currentFile.index+1:1;e={current:t,total:o,processed:e,remaining:o-e-1};console.log(),chrome.runtime.sendMessage({action:"updateAutomationProgress",status:l,filename:this.currentFile?.filename,currentFile:t,totalFiles:o,isTabCompleted:s,updateProgressOnly:!0,updateProgressBar:r,forceProgressUpdate:"Completed"===l,queueProgress:e,statusInfo:c},e=>{console.log(),"Completed"===l&&t>=o&&this.playCompletionSound()})}else chrome.runtime.sendMessage({action:"updateAutomationProgress",status:l,filename:this.currentFile?.filename,currentFile:this.currentFile?.index+1,totalFiles:this.settings?.totalFiles||0,isTabCompleted:s,updateProgressOnly:!0,updateProgressBar:r,forceProgressUpdate:"Completed"===l,statusInfo:c},e=>{console.log(),"Completed"===l&&this.currentFile?.index+1>=(this.settings?.totalFiles||0)&&this.playCompletionSound()})})}getCurrentProductName(){try{var e=document.querySelector(".product-editor");if(e){var o,t=e.querySelector(".product-title");if(t&&t.textContent)return(o=t.textContent.trim().replace(/\s+by\s+Amazon$/i,"")).includes("T-shirt")?"STANDARD_TSHIRT":o.includes("Premium")&&o.includes("T-shirt")?"PREMIUM_TSHIRT":o.includes("V-neck")?"VNECK":o.includes("Tank Top")?"TANK_TOP":o.includes("Long Sleeve")?"STANDARD_LONG_SLEEVE":o.includes("Raglan")?"RAGLAN":o.includes("Pullover Hoodie")?"STANDARD_PULLOVER_HOODIE":o.includes("Zip Hoodie")?"ZIP_HOODIE":o.includes("Sweatshirt")?"STANDARD_SWEATSHIRT":o.toUpperCase().replace(/\s+/g,"_");for(const s of e.className.split(" ")){if(s.includes("STANDARD_TSHIRT"))return"STANDARD_TSHIRT";if(s.includes("PREMIUM_TSHIRT"))return"PREMIUM_TSHIRT";if(s.includes("VNECK"))return"VNECK";if(s.includes("TANK_TOP"))return"TANK_TOP";if(s.includes("LONG_SLEEVE"))return"STANDARD_LONG_SLEEVE";if(s.includes("RAGLAN"))return"RAGLAN";if(s.includes("PULLOVER_HOODIE"))return"STANDARD_PULLOVER_HOODIE";if(s.includes("ZIP_HOODIE"))return"ZIP_HOODIE";if(s.includes("SWEATSHIRT"))return"STANDARD_SWEATSHIRT"}}return this.lastClickedProduct?this.lastClickedProduct:null}catch(e){return console.error(),null}}getScalableProductName(){try{var e=document.querySelector(".product-editor");if(e){var o,t=e.querySelector(".product-title");if(t&&t.textContent)return(o=t.textContent.trim().replace(/\s+by\s+Amazon$/i,"")).includes("PopSockets")?"POP_SOCKET":o.includes("Phone Case")?"PHONE_CASE":o.includes("Mouse Pad")?"MOUSEPAD":o.includes("Tote Bag")?"TOTE_BAG":o.includes("Throw Pillow")?"THROW_PILLOW":o.toUpperCase().replace(/\s+/g,"_");for(const s of e.className.split(" ")){if(s.includes("POPSOCKET"))return"POP_SOCKET";if(s.includes("PHONE_CASE"))return"PHONE_CASE";if(s.includes("MOUSEPAD"))return"MOUSEPAD";if(s.includes("TOTE_BAG"))return"TOTE_BAG";if(s.includes("THROW_PILLOW"))return"THROW_PILLOW"}}return null}catch(e){return console.error(),null}}playCompletionSound(){console.log(),chrome.runtime.sendMessage({action:"getAutomationState"},e=>{var o;e&&e.success&&e.state?(e=e.state,o=this.currentFile?.index+1||1,e=(e.totalFiles||this.settings?.totalFiles||0)<=o,console.log(),chrome.runtime.sendMessage({action:"playCompletionSound",isLastFile:e})):chrome.runtime.sendMessage({action:"playCompletionSound"})})}handleError(e){console.error(),this.retryCount++,this.retryCount<=this.maxRetries?(console.log(),setTimeout(()=>this.startAutomation(),5e3)):(console.error(),this.updateProgressUI("Error: "+e.message,!0),chrome.runtime.sendMessage({action:"showErrorNotification",filename:this.currentFile?.filename,error:e.message}),console.log(),chrome.runtime.sendMessage({action:"markTabCompleted",filename:this.currentFile?.filename,status:"error",error:e.message},e=>{console.log(),console.log(),setTimeout(()=>{this.processNextFile()},1e3)}))}async waitForElement(c,r=3e5){return console.log(),new Promise((o,t)=>{const s=Date.now();var e=document.querySelector(c);if(e)console.log(),o(e);else{const l=()=>{var e=document.querySelector(c);e?(console.log(),o(e)):Date.now()-s>r?(console.warn(),t(new Error)):setTimeout(l,500)};l()}})}async blobUrlToFile(e,o){try{var t=await(await fetch(e)).blob();return new File([t],o,{type:t.type})}catch(e){throw console.error(),e}}base64ToFile(e,o){var e=e.split(","),t=e[0].match(/:(.*?);/)[1],s=atob(e[1]);let l=s.length;for(var c=new Uint8Array(l);l--;)c[l]=s.charCodeAt(l);return new File([c],o,{type:t})}cleanFilenameForTextSwap(e){let o=e.replace(/\.[^/.]+$/,"");return(o=1<(o=o.replace(/[-_]+$/,"")).length||/[-_\s(]/.test(o)?o.replace(/(?:[-_\s]*\d+|[-_\s]*\(\d+\))$/,""):o).trim()}sleep(o){return new Promise(e=>setTimeout(e,o))}async waitForGeneratingImageMessages(){try{return console.log(),this.generatingImageCount=0,new Promise((s,l)=>{const c=Date.now(),r=()=>{let e=!1;for(const o of this.productSelectors.generatingMessages)if(document.body.textContent.includes(o)){e=!0,o;break}if(e){console.log(),this.generatingImageCount++,console.log();const t=()=>{let e=!1;for(const o of this.productSelectors.generatingMessages)if(document.body.textContent.includes(o)){e=!0;break}e?3e5<Date.now()-c?l(new Error):setTimeout(t,500):(console.log(),this.generatingImageCount>=this.requiredGeneratingImageCount?(console.log(),setTimeout(()=>{s()},300)):setTimeout(r,500))};setTimeout(t,500)}else 3e5<Date.now()-c?l(new Error):setTimeout(r,500)};r()})}catch(e){throw console.error(),e}}async processTumblerColors(o){try{console.log(),this.currentOperation="processTumblerColors";var e=null!==document.querySelector(".product-editor");if(console.log(),!e){console.log();var t=document.querySelector(".TUMBLER-edit-btn");if(!t)return void console.error();var s=t.disabled||t.classList.contains("disabled"),l=t.closest(".product-card"),c=l&&l.classList.contains("disabled");if(s||c)return void console.error();console.log(),t.click(),console.log(),await this.sleep(750)}console.log();var r=await this.waitForElement(".color-groups-container");if(r)if(console.log(),document.querySelector(".product-color-actions")){let e;"Dark Colors"===o?(e=document.querySelector("#product-dark-colors-btn"),console.log()):"Light Colors"===o?(e=document.querySelector("#product-light-colors-btn"),console.log()):"All Colors"===o&&(e=document.querySelector("#product-all-colors-btn"),console.log()),(e||(console.log(),"Dark Colors"===o?(e=document.querySelector('button[id="product-dark-colors-btn"]'),console.log()):"Light Colors"===o?(e=document.querySelector('button[id="product-light-colors-btn"]'),console.log()):"All Colors"===o&&(e=document.querySelector('button[id="product-all-colors-btn"]'),console.log()),e))&&(console.log(),e.click(),console.log(),await this.sleep(300)),console.log()}else console.error();else console.error()}catch(e){console.error()}}async processTumblerPrices(e){try{console.log(),this.currentOperation="processTumblerPrices";var o=null!==document.querySelector(".product-editor");if(console.log(),!o){console.log();var t=document.querySelector(".TUMBLER-edit-btn");if(!t)return void console.error();var s=t.disabled||t.classList.contains("disabled"),l=t.closest(".product-card"),c=l&&l.classList.contains("disabled");if(s||c)return void console.error();console.log(),t.click(),console.log(),await this.sleep(750)}if(console.log(),await this.waitForElement(".product-price-actions")){console.log();let s;if("Default Prices"===e?(s=document.querySelector("#product-default-prices-btn"),console.log()):"Suggested Prices"===e?(s=document.querySelector("#product-suggested-prices-btn"),console.log()):"Market Average"===e?(s=document.querySelector("#product-market-average-btn"),console.log()):"Max Prices"===e&&(s=document.querySelector("#product-max-prices-btn"),console.log()),s||(console.log(),"Default Prices"===e?(s=document.querySelector('button[id="product-default-prices-btn"]'),console.log()):"Suggested Prices"===e?(s=document.querySelector('button[id="product-suggested-prices-btn"]'),console.log()):"Market Average"===e?(s=document.querySelector('button[id="product-market-average-btn"]'),console.log()):"Max Prices"===e&&(s=document.querySelector('button[id="product-max-prices-btn"]'),console.log()),s)){var r=s.id;console.log(),console.log(),s.click(),console.log();let e=!1,o=0;for(;!e&&o<10;){await this.sleep(200);var i=document.querySelector("#"+r);i&&(e=i.disabled||i.classList.contains("disabled")||null!==i.getAttribute("disabled"))&&console.log(),o++}console.log();let t=!1;o=0;for(;!t&&o<30;){await this.sleep(300);var n=document.querySelector("#"+r);n&&(t=!n.disabled&&!n.classList.contains("disabled")&&null===n.getAttribute("disabled"))&&console.log(),o++}t||console.log(),console.log(),await this.sleep(250)}console.log()}else console.error()}catch(e){console.error()}}rgbToHex(e){var o=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return o?"#"+parseInt(o[1],10).toString(16).padStart(2,"0")+parseInt(o[2],10).toString(16).padStart(2,"0")+parseInt(o[3],10).toString(16).padStart(2,"0"):e}calculateColorDistance(e,o){var t=parseInt(e.slice(1,3),16),s=parseInt(e.slice(3,5),16),e=parseInt(e.slice(5,7),16),l=parseInt(o.slice(1,3),16),c=parseInt(o.slice(3,5),16),o=parseInt(o.slice(5,7),16);return Math.sqrt((l-t)**2+(c-s)**2+(o-e)**2)}async waitForBackAndPocketMessages(){try{console.log(),console.log(),await this.waitForAnyGeneratingMessage(),console.log(),console.log(),await this.sleep(3e3),console.log(),await this.waitForAnyGeneratingMessage(),console.log(),console.log(),await this.sleep(300),console.log()}catch(e){throw console.error(),e}}async waitForAnyGeneratingMessage(r=3e5){return new Promise((t,s)=>{const l=Date.now(),c=()=>{let e=!1;for(const o of this.productSelectors.generatingMessages)if(document.body.textContent.includes(o)){e=!0,o;break}e?(console.log(),t()):Date.now()-l>r?s(new Error(`Timeout waiting for generating image message after ${r/1e3} seconds`)):setTimeout(c,500)};c()})}async processTumblerSides(o){try{console.log(),this.currentOperation="processTumblerSides";let e;if("Both Sides"===o?(e=Array.from(document.querySelectorAll(".tab-button")).find(e=>e.textContent.trim().includes("Both Sides")||e.textContent.trim().includes("Two Sides")),console.log()):"Default (One Side)"===o&&(e=Array.from(document.querySelectorAll(".tab-button")).find(e=>e.textContent.trim().includes("One Side")||"Front"===e.textContent.trim()),console.log()),e){e.classList.contains("active")?console.log():(console.log(),e.click(),console.log(),await this.sleep(500)),console.log();var t=await this.waitForElement(".resize-btn:not([disabled])");console.log(),t.click(),console.log(),await this.sleep(1500),console.log();try{let e=!1;for(const s of this.productSelectors.generatingMessages)if(document.body.textContent.includes(s)){e=!0,s;break}e?console.log():(console.log(),await this.waitForAnyGeneratingMessage(6e4)),console.log(),await this.sleep(150)}catch(e){console.warn()}}console.log()}catch(e){throw console.error(),e}}async processTumblerScale(t,s){try{console.log(),this.currentOperation="processTumblerScale";var l=null!==document.querySelector(".product-editor");if(console.log(),!l){console.log();var c=document.querySelector(".TUMBLER-edit-btn");if(!c)return void console.error();var r=c.disabled||c.classList.contains("disabled"),i=c.closest(".product-card"),n=i&&i.classList.contains("disabled");if(r||n)return void console.error();console.log(),c.click(),console.log(),await this.sleep(1200)}console.log();var a,d=(this.settings.tumblerProduct||{}).sides||"Default (One Side)",u=(console.log(),Array.from(document.querySelectorAll(".tab-button"))),g=(console.log(),0<u.length&&(console.log(),u.forEach(e=>{console.log()})),u.find(e=>e.classList.contains("active")));let e=null;"Two Sides"===d?(e=u.find(e=>"Two Sides"===e.textContent.trim()),console.log()):"Both Sides"===d?(e=u.find(e=>"Both Sides"===e.textContent.trim()),console.log()):"Default (One Side)"===d&&(e=u.find(e=>"One Side"===e.textContent.trim()||"Default (One Side)"===e.textContent.trim()||"Front"===e.textContent.trim()),console.log()),!e||g&&g.textContent.trim()===e.textContent.trim()?!e&&!g&&0<u.length?(console.log(),a=u[0],console.log(),a.click(),console.log(),await this.sleep(1200)):(g&&e&&(g.textContent.trim(),e.textContent.trim()),console.log()):(console.log(),e.click(),console.log(),await this.sleep(1200)),console.log();let o;if("Keep current"===t)console.log();else if("Custom scale"===t){console.log();var p,h=document.querySelector('input#custom[type="radio"]');if((o=h||(console.log(),document.querySelector('input[type="radio"][id*="custom"], input[type="radio"][value*="custom"]')))&&(console.log(),o.click(),console.log(),await this.sleep(500),s)){console.log();let e=document.querySelector('input[type="number"]:not([disabled])');e||(console.log(),(e=document.querySelector('input[type="number"]'))&&e.disabled&&(console.log(),e.removeAttribute("disabled"),await this.sleep(500))),e||(console.log(),p=[document.querySelector("input.custom-scale-input"),document.querySelector("input.scale-input"),document.querySelector("input.scale-value"),document.querySelector('input[placeholder*="scale"], input[placeholder*="Scale"]'),document.querySelector('input:not([type="radio"])[id*="scale"], input:not([type="radio"])[id*="Scale"]'),document.querySelector('input:not([type="radio"]):not([type="checkbox"]).ng-untouched'),document.querySelector('input[min="50"][max="100"]'),document.querySelector('input[style*="border-bottom: 2px solid"]')],e=p.find(e=>null!==e)),e&&(console.log(),e.disabled&&(console.log(),e.disabled=!1,e.removeAttribute("disabled")),console.log(),e.focus(),await this.sleep(300),console.log(),e.value="",e.dispatchEvent(new Event("input",{bubbles:!0})),await this.sleep(300),console.log(),e.value=s,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),console.log(),e.blur(),await this.sleep(300)),console.log()}}else"100%"===t?(console.log(),(o=document.querySelector("input#percent100"))&&o.click()):"85%"===t?(console.log(),(o=document.querySelector("input#percent85"))&&o.click()):"75%"===t?(console.log(),(o=document.querySelector("input#percent75"))&&o.click()):"Pattern"===t&&(console.log(),o=document.querySelector("input#pattern"))&&o.click();if(o||"Keep current"===t){"Keep current"!==t&&(console.log(),await this.sleep(1e3)),console.log();var m=await this.waitForElement(".resize-btn:not([disabled])");if(m)console.log(),m.click();else{console.log();var S=[document.querySelector("button.resize-btn"),document.querySelector('button[class*="resize"]'),document.querySelector('button:contains("Resize")'),document.querySelector('button:contains("Apply")')].find(e=>null!==e&&!e.disabled);if(!S)return void console.log();console.log(),S.click()}console.log();try{await this.waitForAnyGeneratingMessage(6e4),console.log(),await this.waitForGeneratingImageMessages(),console.log()}catch(e){console.warn(),console.log()}}console.log()}catch(e){console.error()}}hideSnapBulkUploadButton(){try{console.log();var e=document.createElement("style"),o=(e.id="snap-automation-hide-button-style",e.textContent=`
                #snap-bulk-upload-btn {
                    display: none !important;
                    visibility: hidden !important;
                    opacity: 0 !important;
                    pointer-events: none !important;
                }
            `,document.head.appendChild(e),document.querySelector("#snap-bulk-upload-btn"));o&&(o.style.display="none",o.style.visibility="hidden",o.style.opacity="0",o.style.pointerEvents="none",console.log()),new MutationObserver(e=>{for(const t of e)if("childList"===t.type&&0<t.addedNodes.length)for(const s of t.addedNodes){var o;s.nodeType===Node.ELEMENT_NODE&&("snap-bulk-upload-btn"===s.id&&(s.style.display="none",s.style.visibility="hidden",s.style.opacity="0",s.style.pointerEvents="none",console.log()),o=s.querySelector("#snap-bulk-upload-btn"))&&(o.style.display="none",o.style.visibility="hidden",o.style.opacity="0",o.style.pointerEvents="none",console.log())}}).observe(document.body,{childList:!0,subtree:!0}),console.log()}catch(e){console.error()}}}window.snapAutomation=new SnapAutomation;